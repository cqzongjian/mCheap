<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>hos_content</title>
    <meta name="viewport" content="target-densitydpi=device-dpi,width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="../../../static/mdui/css/mdui.min.css">
    <link rel="stylesheet" href="../../../static/mCheap/css/mCommon.css">
</head>
<style>
    *{
        font-family: "Microsoft YaHei";
    }
    body{
        background-color: #E6EAE8;
        padding-top: 2.75rem;
    }
    .header-box{
        background-color: #0eb7ed;
        padding:0;
    }
    .header{
        width: 100%;
        height:100%;
        position: relative;
    }
    .back{
        padding-right:1rem;
        padding-left:1rem;
        padding-top:0.75rem;
        position:absolute;
        z-index:100;
    }
    .back img{
        width:auto;
        height:1.25rem;
    }
    .title{
        text-align:center;
        position:absolute;
        width:100%;
        height:100%;
        top:0;
        line-height: 2.75rem;
        color:#FFFFFF;
    }
    .choose-table{
        border-bottom: 1px solid #CCCCCC;
        background-color: white;
        padding: 1rem;
    }
    .item-title{
        text-align: center;
        width: 50%;
    }
    .item-title-on{
        color:#0eb7ed;
    }
    .input-box{
        width: 100%;
        height: 3rem;
        background-color: white;
        border-bottom: 1px solid #CCCCCC;
    }
    #input-name,#input-num,#input-money,#input-date,#input-username,#input-user-phone{
        height: 2.5rem;
        width: 100%;
        margin: 0.25rem ;
    }
    .input-name{
        width: 6rem;
        padding-left: 1rem;
        padding-top: 1rem;
        padding-bottom: 1rem;
    }
    .necessary-icon{
        height: 100%;
        width: 3rem;
        line-height: 3rem;
        text-align: center;
        color: red;
    }
    .beizhu{
        background-color: white;
        padding: 1rem;
    }
    .price-compare{
        background-color: white;
        height: 2.75rem;
        margin-top: 0.25rem;
        border-bottom: 1px solid #CCCCCC;
        border-top: 1px solid #CCCCCC;
        text-align: center;
        line-height: 2.75rem;
    }
    .compare-box{
        background-color: white;
    }
    .medicine-box{
        padding: 1rem;
    }
    .medicine-factory{
        padding:0 1rem 1rem 1rem;
    }
    .area{
        margin-left: 0.5rem;
        margin-right: 0.5rem;
    }
    .hos-name{
        height: 2.75rem;
        width: 100%;
        text-align: center;
        line-height: 2.75rem;
        background-color: white;
        border-bottom: 1px solid #CCCCCC;
    }
    .medicine{
        border-bottom: 1px solid #CCCCCC;
    }
    .no-compare-data {
        width: 100%;
        text-align: center;
    }


</style>
<body>
<div class="header-box mdui-bar mdui-bar-nav">
    <div class="header">
        <div class="back mdui-action-back"><img src="../image/back.png"></div>
        <div class="title">我的报价</div>
    </div>
</div>
<div id="content">
    <div class="hos-name">某某医院</div>
    <div class="mdui-box choose-table">
        <div class="item-title item-title-on" id="yp" data-type="drug">药品</div>
        <div>|</div>
        <div class="item-title" id="server" data-type="service">医疗服务</div>
    </div>
    <div class="input-box mdui-box">
        <div class="input-name">用户昵称 :</div>
        <div class="mdui-box-flex-1">
            <input type="text" id="input-username" placeholder=""/>
        </div>
        <div class="necessary-icon">*</div>
    </div>
    <div class="input-box mdui-box">
        <div class="input-name">联系电话 :</div>
        <div class="mdui-box-flex-1">
            <input type="number" id="input-user-phone"/>
        </div>
        <div class="necessary-icon"></div>
    </div>
    <div class="input-box mdui-box">
        <div class="input-name">名称 :</div>
        <div class="mdui-box-flex-1">
            <input type="text" id="input-name"/>
        </div>
        <div class="necessary-icon">*</div>
    </div>

    <div class="input-box mdui-box">
        <div class="input-name">数量 :</div>
        <div class="mdui-box-flex-1">
            <input type="number" id="input-num" value="1"/>
        </div>
        <div class="necessary-icon">*</div>
    </div>

    <div class="input-box mdui-box">
        <div class="input-name">金额(元):</div>
        <div class="mdui-box-flex-1">
            <input type="number" id="input-money"/>
        </div>
        <div class="necessary-icon">*</div>
    </div>

    <div class="input-box mdui-box">
        <div class="input-name">结算日期 :</div>
        <div class="mdui-box-flex-1">
            <input type="date" id="input-date"/>
        </div>
        <div class="necessary-icon">*</div>
    </div>
    <div class="beizhu">备注 :</div>
    <div class="area">
        <textarea name="" id="remark" cols="10" rows="5"></textarea>
    </div>

    <div class="price-compare">
        <a href="#C4" style="display:inline-block;width: 100%;height: 100%;">价格比较</a>
    </div>

    <div class="compare-box-all">
        <a name="C4"></a>
        <div class="compare-box">

            <div class="medicine">
               <!-- <div class="medicine-box mdui-box">
                    <div class="no-compare-data">无比对信息</div>
                </div>-->
                <!--<div class="medicine-box mdui-box">
                    <div class="medicine-name mdui-box-flex-1">药品名字</div>
                    <div class="medicine-price">￥8元</div>
                </div>
                <div class="medicine-factory">厂商：beiaa</div>-->
            </div>

        </div>
    </div>
</div>
<script src="../../../static/mdui/js/mdui.js"></script>
<script src="../../../server_two.js"></script>
<script>
    var pageObj={};
    $.uexWindowReady(function(){
        pageObj.type='drug';
        $('#yp').trigger('tap');
        var pagedata = $.strToJson($.pageParam);
        pageObj.hosId=pagedata.hosId;
        pageObj.hosName=pagedata.hosName;
        $('.hos-name').html(pageObj.hosName);
        pageObj.hosCode=pagedata.hosCode;
        pageObj.hoslevel=pagedata.hoslevel;
    });

    //切换tab
    $('.item-title').on('click',function(){
        pageObj.type=$(this).data('type');
        var ele=$('.item-title');
        ele.removeClass('item-title-on');
        $(this).addClass('item-title-on');
        $('#input-date').val('');
        $('#input-name').val('');
        $('#input-money').val('');
        $('#remark').val('');
        $('.compare-box').html('');
    });

    $('#input-num').on('blur',function(){
        var cost_count=$('#input-num');
        if(cost_count.val()<1){
            alert('数量至少为1');
            cost_count.val(1);
        }
//        var reg = "^([0-9]*[.0-9])$"; // 小数
        if(!cost_count.val().match(/^([0-9]*[.0-9])$/)){
            alert('数量格式不正确');
            cost_count.val(1);
        }
    });

    $('.price-compare').on('tap',function(){
        var person_name=$('#input-username').val();
        var phone=$('#input-user-phone').val();
        var cost_date=$('#input-date').val();
        var hospital_code=pageObj.hosCode;
        var hospital_level=pageObj.hoslevel;
        var cost_type=pageObj.type;
        var cost_name=$('#input-name').val();
        var cost_count=$('#input-num').val();
        var cost_money=$('#input-money').val();
        var remark=$('#remark').val()||'';
        if(person_name&&cost_name&&cost_count&&cost_money&&cost_date){
            getMedicalInfo(person_name,phone,cost_date,hospital_code,hospital_level,cost_type,cost_name,cost_count,cost_money,remark);
        }else{
            alert('请补全带*的输入框');
        }
    });



    //获取热门产品
    function getMedicalInfo(person_name,phone,cost_date,hospital_code,hospital_level,cost_type,cost_name,cost_count,cost_money,remark){
       $.request({
            urlType:'queryDrugSimilar',
            data:{
                "access_token": $.getStorage('access_token'),
                hospitalid:pageObj.hosId,
                hospital_name:$('.hos-name').html(),
                person_name:person_name,//姓名
                phone:phone,//联系方式
                cost_date:cost_date,//-结算日期
                hospital_code:hospital_code,//医院编号
                hospital_level:hospital_level,//医院等级
                cost_type:cost_type,//收费类别（医疗服务service/药品drug） 选项上面 传service或者drug
                cost_name:cost_name,//收费项目名称(就是桌面上的名称)
                cost_count:cost_count,//
                cost_money:cost_money,
                remark:remark,//备注
                loginid:$.getStorage('loginid_username')||''
            }
        },function(json){
            if(json.flag) {
                var html='';
                var len = json.result.length;
                if(len){
                    for(var i= 0;i<len;i++){
                        html+='<div class="medicine">';
                        html+='<div class="medicine-box mdui-box">';
                        html+='<div class="medicine-name mdui-box-flex-1">'+(cost_type=='drug'?json.result[i].drug_name:json.result[i].service_name)+'</div>';
                        if(json.result[i].price=='' || json.result[i].price==null){
                            html+='<div class="medicine-price">'+'暂无价格信息'+'</div>';
                        }else{
                            html+='<div class="medicine-price">'+'￥'+json.result[i].price+'元'+'</div>';
                        }
                        html+='</div>';
                        if(cost_type=='drug'){
                            html+='<div class="medicine-factory">厂商：'+json.result[i].supplier+'</div>';
                        }
                        html+='</div>';
                    }
                }else{
                    html+='<div class="medicine-box mdui-box">';
                    html+='<div class="no-compare-data">无比对信息</div>';
                    html+='</div>';
                }
                $('.compare-box').html(html);
                $('body')[0].scrollTop = $('.compare-box-all')[0].scrollTop+1000;
            }
        });
    }
</script>
</body>
</html>