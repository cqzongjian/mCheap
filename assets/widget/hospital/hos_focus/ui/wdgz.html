<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>mCollection</title>
    <meta name="viewport" content="target-densitydpi=device-dpi,width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="../../../static/mdui/css/mdui.min.css">
    <link rel="stylesheet" href="../../../static/mCheap/css/mCommon.css">
    <style>
        *{
            font-family: "Microsoft YaHei";

        }
        body{
            background-color: #ffffff;
            padding-top: 2.75rem;
        }
        .header-box{
            background-color: #0eb7ed;
            padding: 0;
        }
        .header{
            width: 100%;
            height: 100%;
            position: relative;
        }
        .back{
            padding-right: 1rem;
            padding-left: 1rem;
            padding-top: 0.75rem;
            position: absolute;
            z-index: 100;
        }
        .back img{
            width:auto;
            height: 1.25rem;
        }
        .title{
            text-align: center;
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0px;
            line-height: 2.75rem;
            color: #FFFFFF;
        }
        .sort{
             padding-top: 0.5rem;
             border-bottom: 1px solid #cccccc;
             color: #666666;

         }
        .sort-item{

        }
        .start-img{
            float: left;
        }
        .start{
            width: 1rem;
            height: 1rem;
        }
        .start-box{
            margin-left:1rem;
        }
        .sort-item-text{
            padding-bottom: 0.5rem;
            width: 80%;
            text-align: center;
            margin: 0 auto;
            border-bottom: 0.2rem solid #FFFFFF;
        }
        .sort-item-gap{
            color: #cccccc;
        }
        .sort-item-on{
            color:#0eb7ed;
            border-bottom: 0.2rem solid #0eb7ed;
        }
        .onTouch{
            background-color:#F5F5F5;

        }
        #content_box{
            padding-top: 0;
            background-color:#ffffff;
        }
        ol,ul{
            list-style:none;
            list-style-position:initial;
            list-style-image:initial;
        }
        .search{
            margin:0px;
            padding:10px 0px 20px 0px;
        }
        .search li .con-open{
            height: auto;
        }
        .section .section-box .content-left .search li .con .act {
            background-color: #1b97dc;
            color: #fff;
        }
        .section .section-box .content-left .search li .con  a{
            width: 100%;
            height: 100%;
            line-height: 26px;
            overflow: hidden;
        }
        .section .section-box .content-left .search li>p {
            margin-bottom: 5px;
        }
        .search li .con a {
            display: block;
            margin: 0 10px;
            color: #333;
            text-decoration: none;
            padding: 0 3px;
        }
        .fl {
            float: left;
        }
        *:before, *:after {
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }
        .mdui-clearfix:before{
            content:"";
            display: table;
        }
        p {
            margin: 0 0 10px;
        }
        .mdui-clearfix:after {
            content: "";
            display: block;
            clear: both;
            visibility: hidden;
            line-height: 0;
            height: 0;
        }
        .list:hover {
            background-color: #f5f5f5;
        }
        .line-top {
            border-top: 1px solid #ddd;
        }
        .list {
            border-bottom: 1px solid #ddd;
            padding: 10px 0px;
        }
        .list .photo {
            width: 5rem;
        }
        .list .photo .thumbnail {
            margin-top: 1rem;
            height: 8rem;
        }
        .list .photo .thumbnail img {
            width: 7rem;
            height: 100%;
        }
        .thumbnail {
            display: block;
            padding: .3rem;
            margin-bottom: 2rem;
            line-height: 1.42857143;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            -webkit-transition: border .2s ease-in-out;
            -o-transition: border .2s ease-in-out;
            transition: border .2s ease-in-out;
        }
        * {
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }
        h4, .h4 {
            font-size: 18px;
            color: inherit;
        }
        h4 {
            display: block;
            -webkit-margin-before: 1.33em;
            -webkit-margin-after: 1.33em;
            -webkit-margin-start: 0px;
            -webkit-margin-end: 0px;
            font-weight: bold;
        }
        a {
            color: #1b97dc;
            text-decoration: none;
        }
        a {
            background-color: transparent;
        }
        .list .con h4 .label {
            margin-left: 10px;
            padding: 0.1em 0.7em;
            font-size: 12px;
            font-weight: normal;
        }

      .list .photo {
            width: 37%;
          height: 100%;
        }
        .list .con {
            margin-top: 1.5rem;
            width: 63%;
            height: 100%;
        }
        .address{
            margin-top: 2.0rem;
        }
        .tj-list-item{
            padding: 0.5rem 1rem;
            border-bottom: 1px solid #cccccc;
            position: relative;
            width: 100%;
        }
        .tj-list-item:last-child{
            border: none;
        }
        .tj-list-item>div>img {
            width: 5rem;
            height: 4rem;
            border-radius: 5px;
        }
         .list-item-title {
             text-overflow: ellipsis;
             overflow: hidden;
             white-space: nowrap;
             height: 1rem;
             width:12rem;
             line-height: 1rem;
             color: #000000;
             margin-top: 0.3rem;
             margin-left:1rem;
        }
         .star{
             margin-left:1rem;
         }
        .star>img {
            height: 0.8rem;
            width: auto;

        }
        img{
            border:0px;
        }
        .market-address, .market-yysj {
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
            font-size: .8rem;
            font-weight: normal;
            color: #666666;
            height: 1rem;
            line-height: 1rem;
            padding-left: 1rem;
            margin-left:1rem;
        }
        .market-yysj {
            background: url(../image/time.png) no-repeat left center;
            background-size: 0.8rem auto;
        }
        .market-address {
            background: url(../image/dis.png) no-repeat left center;
            background-size: 0.8rem auto;
        }
        .market-dis {
            position: absolute;
            top: 4rem;
            right: 1rem;
            font-size: 0.9rem;
            color: #666666;
        }
        .like,.dislike{
            position: absolute;
            width: 1rem;
            height: 1rem;
            background-size: auto 0.9rem;
            background-repeat: no-repeat;
            background-position: center;
            top: .8rem;
        }
        .like{
            right: 2rem;
            background-image:url("../image/like.png");
        }
    </style>
</head>
<body>
<div class="header-box mdui-bar mdui-bar-nav">
    <div class="header">
        <div class="back mdui-action-back"><img src="../image/back.png"></div>
        <div class="title">我的关注</div>
    </div>
</div>
<div class="sort ">
    <!--<div class="tj-list-item mdui-box">-->
        <!--<div>-->
            <!--<img src="../image/kb.png">-->
        <!--</div>-->
        <!--<div class="mdui-box-flex-1">-->
            <!--<div class="list-item-title">双人青椒肉丝套fsdfsfs双人青椒肉丝套fsdfsfs双人青椒肉丝套fsdfsfs</div>-->
            <!--<div class="star"><img src="../image/star_01.png"/>-->
                <!--<img src="../image/star_02.png"/>-->
                <!--<img src="../image/star_03.png"/>-->
                <!--<img src="../image/star_02.png"/>-->
                <!--<img src="../image/star_03.png"/></div>-->
            <!--<div class="market-address">府城大道东段77号</div>-->
            <!--<div class="market-yysj">营业时间：8:00-17:00</div>-->
        <!--</div>-->
        <!--<div class="market-dis">1.7km</div>-->
    <!--</div>-->
    <!--<div class="tj-list-item mdui-box">-->
        <!--<div>-->
            <!--<img src="../image/kb.png">-->
        <!--</div>-->
        <!--<div class="mdui-box-flex-1">-->
            <!--<div class="list-item-title">华西医院</div>-->
            <!--<div class="star"><img src="../image/star_01.png"/>-->
                <!--<img src="../image/star_02.png"/>-->
                <!--<img src="../image/star_03.png"/>-->
                <!--<img src="../image/star_02.png"/>-->
                <!--<img src="../image/star_03.png"/></div>-->
            <!--<div class="market-address">府城大道东段77号</div>-->
            <!--<div class="market-yysj">营业时间：8:00-17:00</div>-->
        <!--</div>-->
        <!--<div class="islike dislike"></div>-->
        <!--<div class="market-dis">1.7km</div>-->
    <!--</div>-->
    <!--<div class="tj-list-item mdui-box">-->
        <!--<div class="triggertap" data-clthtp01001="成都市公共卫生"data-clthtp01006="四川省成都市温江区麻市街33号"data-clthtp01013="undefined"data-clthtp01011="8：00 - 17：00"data-clthtp01id="5"data-tiaoshu="null"data-isfocus="1">-->
            <!--<img src="../image/kb.png">-->
        <!--</div>-->
        <!--<div class="mdui-box-flex-1">-->
            <!--<div class="list-item-title">成都市公共卫生</div>-->
                <!--<div class="star">-->
                    <!--<img src="../image/star_02.png" />-->
                    <!--<img src="../image/star_02.png" />-->
                    <!--<img src="../image/star_02.png" />-->
                    <!--<img src="../image/star_02.png" />-->
                    <!--<img src="../image/star_02.png" />-->
                <!--</div><div class="market-address">四川省成都市温江区麻市街33号</div>-->
                <!--<div class="market-yysj">营业时间：8：00 - 17：00</div>-->
            <!--</div>-->
        <!--<div class="market-dis">7133.7km</div>-->
        <!--<div class="like"></div>-->
    <!--</div>-->
</div>


<!--页面-->
<script src="../../../static/mdui/js/mdui.js"></script>
<script src="../../../static/mCheap/js/mCheap.config.js"></script>
<script src="../../../public.js"></script>
<script src="../../../server.js"></script>
<script>
    $.uexWindowReady(function(){
        //加载我关注的医院
        getMyFocusHos();
    });

    //请求关注的医院
    function getMyFocusHos(){
        $.request({
            urlType: 'hos_fouceHosiptalInfo',
            data:{
                "access_token": $.getStorage('access_token'),
                'log' :$.getStorage("log"),//经度
                'lat' :$.getStorage("lat"),//纬度
                homepage:"no"
            }
        },function(json){
            if(json.success) {
                var len=json.data.length,data=json.data;
                if(len){
                    setMyFocusHos(data);
                }else{
                    $.toast('当前暂时没有关注的医院');
                }
            }else{
                $.toast('网络异常，请稍后再试');
            }
        })
    }

    function setMyFocusHos(data){
        var html = "",len=data.length;
        for(var i = 0;i<len;i++){
            var m=0;
            var j=0;
            html += '<div class="tj-list-item mdui-box" data-clthtp01001="' +data[i].clthtp01001+'" data-clthtp01006="' +data[i].clthtp01006+'" data-clthtp01013="' +data[i].clthtp01013+'" data-clthtp01011="' +data[i].clthtp01011+'" data-clthtp01id="'+data[i].clthtp01id+'" data-isfocus="'+data[i].isfocus+'" data-distance="' +data[i].distance+'" data-hospic="' +data[i].clthtp01010+'" data-log="' +data[i].clthtp01004+'" data-lat="' +data[i].clthtp01005+'">';
            html += '<div class="hospital-img">';
            html +='<img src="'+$.serverSettings.serverPath+'/mobile/mcheap/hosiptalAction!getHosiptalPicture.do?access_token='+$.getStorage('access_token')+'&url='+data[i].clthtp01010+'"/>';
            html +='</div>';
            html +='<div class="mdui-box-flex-1">';
            html += '<div class="list-item-title">'+data[i].clthtp01001+'</div>';
            html += '<div class="star">';
            if(data[i].star) {
                for(j;j<parseInt(data[i].star);j++){
                    html+='<img src="../image/star_01.png" />';
                    m++;
                }
                if (parseInt(data[i].star.split('.')[1])>0){
                    html+='<img src="../image/star_03.png"/>';
                    m++;
                }
                if(m<5){
                    for (j=m;j<5;j++){
                        html+='<img src="../image/star_02.png"/>';
                    }
                }
            }
            else{
                for (j=0;j<5;j++){
                    html+='<img src="../image/star_02.png" />'
                }
            }
            html+= '</div>';
            html+= '<div class="market-address">'+data[i].clthtp01006+'</div>';
            html+= '<div class="market-yysj">营业时间：' + data[i].clthtp01011  + '</div>';
            html+= '</div>';
            html+= '<div class="market-dis">'+data[i].distance+'km</div>';
            html+= '<div class="like" data-clthtp01id="'+data[i].clthtp01id+'" data-clthtp01001="'+data[i].clthtp01001+'"></div>';
            html+= '</div>';
        }
        $(".sort").html(html);
        clickMyFocus();
        dellFoucs();
    }
    /*
    点击医院关注列表
    */
    function clickMyFocus(){
        $('.sort').on('tap','.hospital-img',function(){
            $.openWin({
                name:'hos_main',
                animId : 2,
                url:'wgtroot://hospital/hos_main/ui/hos_main.html',
                pageParam:{
                    cltpit01id:$(this).parent().data('cltpit01id'),
                    title:$(this).parent().data('clthtp01001'),
                    address:$(this).parent().data('clthtp01006'),
                    distance:$(this).parent().data('distance'),
                    clthtp01013:$(this).parent().data('clthtp01013'),
                    time:$(this).parent().data('clthtp01011'),
                    hospic:$(this).parent().data('hospic'),
                    focus:$(this).parent().data('isfocus'),
                    log:$(this).parent().data('log'),
                    lat:$(this).parent().data('lat')
                }
            });
        })
    }
    //取消关注
    function dellFoucs(){
        $('.like').on('click',function(){
            var self=$(this);
            $.request({
                urlType:'hos_delFocusHosiptal',
                data:{
                    'access_token':$.getStorage('access_token'),
                    clthtp01id:$(this).data('clthtp01id'),
                    clthtp01001:$(this).data('clthtp01001')
                }
            },function(data){
                if(data.success){
                    $.toast("取消关注成功");
                    self.parent().remove();
                    $.execScript({
                        winName:'hos_list',
                        frameName:'hospital_content',
                        script:'requestFocusHos()'
                    });
                }else{
                    $.toast("网络异常,清稍后再试！")
                }
            })
        })
    }
</script>
</body>
</html>