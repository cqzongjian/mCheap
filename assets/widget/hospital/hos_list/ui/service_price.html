<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>mCollection</title>
    <meta name="viewport" content="target-densitydpi=device-dpi,width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="../../../static/mdui/css/mdui.min.css">
    <link rel="stylesheet" href="../../../static/mCheap/css/mCommon.css">
    <style>
        *{
            font-family: "Microsoft YaHei";
            line-height: 1rem;
        }
        body{
            background-color: #FFFFFF;
            padding-top: 2.75rem;
        }
        .header-box{
            background-color: #3BA15C;
            padding: 0;
        }
        .header{
            width: 100%;
            height: 100%;
            position: relative;
        }
        .back{
            padding-right: 1rem;
            padding-left: 0.625rem;
            margin-top: 0.75rem;
        }
        .back img{
            width:auto;
            height: 1.25rem;
        }
        #search{
            border: none;
            height: 1.75rem;
        }
        .search-box{
            border: 1px solid #cccccc;
            border-radius: 5px;
            background-color: #FFFFFF;
            height: 1.75rem;
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
            overflow: hidden;
        }
        .search-img{
            height:1.75rem;
            line-height: 1.75rem;
            margin-right: 0.5rem;
            margin-top: 0.25rem;
            margin-bottom: 0.25rem;
            padding-left: 2rem;
        }
        .search-img>img{
            width: 1.25rem;
            height: 1.25rem;
        }
        .header-right{
            padding-left: 1rem;
            padding-right: 0.625rem;
            margin-top: 0.75rem;
            position: relative;
        }
        .header-right>img {
            width: auto;
            height: 1.25rem
        }
        .sort{
            padding-top: 0.5rem;
            border-bottom: 1px solid #cccccc;
            color: #666666;
            font-weight: 600;

            position: fixed;
            width: 100%;
            background-color: white;
        }
        .sort-item-text{
            padding-bottom: 0.5rem;
            width: 80%;
            text-align: center;
            margin: 0 auto;
            border-bottom: 0.2rem solid #FFFFFF;
        }
        .sort-item-gap{
            color: #cccccc;
        }
        .sort-item-on{
            color:#3BA15C;
            border-bottom: 0.2rem solid #3BA15C;
        }
        /*.table{*/
            /*display: table;*/
            /*width: 100%;*/
        /*}*/
        /*.table>div{*/
            /*display: table-row;*/
        /*}*/
        /*.table>div>div{*/
            /*display: table-cell;*/
            /*padding-left: 1rem;*/
        /*}*/
        /*.content{*/
            /*padding-top: .5rem;*/
        /*}*/
        /*=======table=======*/
        .content{
            padding-top: 2rem;
        }
        .more{
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
            bottom: 0;
            width: 100%;
            border: 1px solid #DCDCDC;
            background: url("../images/arraow_down.png")no-repeat 65%;
            background-size: 1rem 0.5rem;
            text-align: center;
        }
        .col{
            width: 100%;
            border-bottom:1px solid #DCDCDC;
        }
        .row-one{
            width: 70%;
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
            padding-left: 1rem;
            border-right: 1px solid #DCDCDC;
        }
        .row-two{
            width: 30%;
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
            padding-left: 1rem;
        }
        .sj_dj,.sy_dj,.ej_dj,.ey_dj{
            display: none;
        }

    </style>
</head>
<body>
<div class="header-box mdui-bar mdui-bar-nav">
    <div class="header  mdui-box">
        <div class="back mdui-action-back"><img src="../images/back.png"></div>
        <div class="mdui-box-flex-1 mdui-box search-box">
            <div class="mdui-box-flex-1">
                <input type="text" id="search"  placeholder="请输入服务名称"/>
            </div>
            <div class="search-img"><img src="../images/search.png"></div>
        </div>
        <div class="header-right">
            <img src="../images/share.png">
        </div>
    </div>
</div>
<div class="sort mdui-box">
    <div class="mdui-box-flex-1 sort-item">
        <div id="sj" class="sort-item-text">三甲</div>
    </div>
    <div class="sort-item-gap">|</div>
    <div class="mdui-box-flex-1 sort-item">
        <div id="sy" class="sort-item-text">三乙</div>
    </div>
    <div class="sort-item-gap">|</div>
    <div class="mdui-box-flex-1 sort-item">
        <div id="ej" class="sort-item-text">二甲</div>
    </div>
    <div class="sort-item-gap">|</div>
    <div class="mdui-box-flex-1 sort-item">
        <div id="ey" class="sort-item-text">二乙</div>
    </div>
</div>
<div class="mdui-box-flex-1 content">
    <div id="table">
        <!--<div class="col mdui-box">-->
            <!--<div class="row-one">诊疗费3j</div>-->
            <!--<div class="row-two sj_dj">￥0/次</div>-->
            <!--<div class="row-two sy_dj">￥1/次</div>-->
            <!--<div class="row-two ej_dj">￥2/次</div>-->
            <!--<div class="row-two ey_dj">￥3/次</div>-->
        <!--</div>-->
        <!--<div class="col">-->
            <!--<div class="more">展开更多</div>-->
        <!--</div>-->
    </div>
</div>
<script src="../../../static/mdui/js/mdui.js"></script>
<script src="../../../static/mCheap/js/mCheap.config.js"></script>
<script src="../../../server.js"></script>
<script src="../../../public.js"></script>
<script>
    var page=1;//记录页面是第几页
    var chooseTab=1;//记录当前选中的是哪个tab
    $.uexWindowReady(function(){
        request();
    });

    /*
     * 点击搜索按钮
     * */
    $('.search-img').on('tap',function() {
        page=1;
        var name=$('#search').val();
        $('#table').html('');
        if(name){
            $.request({
                urlType:'getStandomPriceGroupHsLevel',
                data: {
                    access_token: $.getStorage('access_token'),
                    page:page,
                    pageSize:20,
                    name:name
                }
            }, function (data) {
                if(data.success) {
                    setData(data);
                    changeTab(chooseTab);
                }
                else{
                    $.toast(data.message);
                }
            }, 'json')
        }else{
            alert("请输入查询信息");
        }
    });

    /*
     * 图标切换
     * */
    $('.sort>.sort-item').on('tap',function(){
        var ele=$('.sort-item');
        ele.on('tap',function(){
            var target=$(this).find('.sort-item-text');
            if(!target.hasClass('sort-item-on')) {
                ele.find('.sort-item-text').removeClass('sort-item-on');
                target.addClass('sort-item-on');
                var text = $(this).find('.sort-item-text').text();
                switch (text){
                    case '三甲':{
                        $('.sj_dj').show();
                        $('.sy_dj').hide();
                        $('.ej_dj').hide();
                        $('.ey_dj').hide();
                        chooseTab=1;
                        break;
                    }
                    case '三乙':{
                        $('.sj_dj').hide();
                        $('.sy_dj').show();
                        $('.ej_dj').hide();
                        $('.ey_dj').hide();
                        chooseTab=2;
                        break;
                    }
                    case '二甲':{
                        $('.sj_dj').hide();
                        $('.sy_dj').hide();
                        $('.ej_dj').show();
                        $('.ey_dj').hide();
                        chooseTab=3;
                        break;
                    }
                    case '二乙':{
                        $('.sj_dj').hide();
                        $('.sy_dj').hide();
                        $('.ej_dj').hide();
                        $('.ey_dj').show();
                        chooseTab=4;
                        break;
                    }
                }
            }
        });
    });

    /*
     * 请求医院信息
     * */
    function request() {
        $.request({
            urlType:'getStandomPriceGroupHsLevel',
            data: {
                access_token: $.getStorage('access_token'),
                page:page,
                pageSize:20
            }
        }, function (data) {
            if(data.success) {
                setData(data);
                $('#sj').addClass('sort-item-on');
                changeTab(chooseTab);
            }
            else{
                //$.toast('网络错误');
            }
        }, 'json')
    }

    /*
     * 设置医院信息
     * */
    function setData(data){
        $('.more-box').remove();
        var html='';
        var len=data.data.length;
        if(len){
            for(var i=0;i<len;i++){
                html+='<div class="col mdui-box">';
                html+='<div class="row-one">'+data.data[i].cdms01001+'</div>';
                html+='<div class="row-two sj_dj">￥'+data.data[i].cdms01005+'/'+data.data[i].cdms01004+'</div>';
                html+='<div class="row-two sy_dj">￥'+data.data[i].cdms01006+'/'+data.data[i].cdms01004+'</div>';
                html+='<div class="row-two ej_dj">￥'+data.data[i].cdms01007+'/'+data.data[i].cdms01004+'</div>';
                html+='<div class="row-two ey_dj">￥'+data.data[i].cdms01008+'/'+data.data[i].cdms01004+'</div>';
                html+='</div>';
            }
            html+='<div class="col more-box">';
            html+='<div class="more">展开更多</div>';
            html+='</div>';
            $('#table').append(html);
        }else{
            alert("抱歉，暂无数据");
        }
    }

    /*
     * 设置更多信息
     * */
    $(document).on('tap','.more',getMoreData);
    function getMoreData(){
        var name=$('#search').val();
        var start=++page;
        if(name){
            $.request({
                urlType:'getStandomPriceGroupHsLevel',
                data: {
                    access_token: $.getStorage('access_token'),
                    page:start,
                    pageSize:20,
                    name:name
                }
            }, function (data) {
                if(data.success) {
                    setData(data);
                    changeTab(chooseTab);
                }
                else{
                    $.toast(data.message);
                }
            }, 'json')
        }else{
            $.request({
                urlType:'getStandomPriceGroupHsLevel',
                data: {
                    access_token: $.getStorage('access_token'),
                    page:start,
                    pageSize:20
                }
            }, function (data) {
                if(data.success) {
                    setData(data);
                    changeTab(chooseTab);
                }
                else{
                    $.toast(data.message);
                }
            }, 'json')
        }
    }

    /*
     * tab切换
     * */
    function changeTab(chooseTab){
        switch (chooseTab){
            case 1:{
                $('.sj_dj').show();
                $('.sy_dj').hide();
                $('.ej_dj').hide();
                $('.ey_dj').hide();
                break;
            }
            case 2:{
                $('.sj_dj').hide();
                $('.sy_dj').show();
                $('.ej_dj').hide();
                $('.ey_dj').hide();
                break;
            }
            case 3:{
                $('.sj_dj').hide();
                $('.sy_dj').hide();
                $('.ej_dj').show();
                $('.ey_dj').hide();
                break;
            }
            case 4:{
                $('.sj_dj').hide();
                $('.sy_dj').hide();
                $('.ej_dj').hide();
                $('.ey_dj').show();
                break;
            }
        }
    }



</script>
</body>
</html>