<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>mCollection</title>
    <meta name="viewport" content="target-densitydpi=device-dpi,width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="../../../static/mdui/css/mdui.min.css">
    <link rel="stylesheet" href="../../../static/mCheap/css/mCommon.css">
    <link rel="stylesheet" href="../css/hos_list.css">
</head>
<body>
<div class="header-box mdui-bar mdui-bar-nav">
    <div class="header  mdui-box">
        <div class="back mdui-action-back"><img src="../images/back.png"></div>
        <div class="mdui-box-flex-1" style="text-align: center;color: white;line-height: 3rem;">
            医院
            <!--<div class="mdui-box-flex-1">-->
                <!--<input type="text" id="search"  placeholder="请输入医院名称"/>-->
            <!--</div>-->
            <!--<div class="search-img"><img src="../images/search.png"></div>-->
        </div>
        <div class="header-right">
            <img src="../images/share.png">
        </div>
    </div>
</div>
<div class="sp mdui-box">
    <div class="mdui-box-flex-1">成都市医疗服务项目与价格</div>
    <div class="arrow"></div>
</div>
<div class="list">
    <!--<div class="list-item">-->
        <!--<div class="item-content mdui-box">-->
            <!--<div class="item-img"></div>-->
            <!--<div class="mdui-box-flex-1">-->
                <!--<div class="item-title">成都市第十人民医院</div>-->
                <!--<div class="item-sub">地址：成都市锦江区</div>-->
                <!--<div class="item-time">门诊时间：8:15-17:30</div>-->
            <!--</div>-->
        <!--</div>-->
        <!--<div class="item-dis">1.7km</div>-->
    <!--</div>-->
</div>
<script src="../../../static/mdui/js/mdui.js"></script>
<script src="../../../static/mCheap/js/mCheap.config.js"></script>
<script src="../../../server.js"></script>
<script src="../../../public.js"></script>
<script>
    $.uexWindowReady(function(){
        /*
        * 请求医院信息
        * */
        function _request(name) {
            function openLocation() {
                var locLevel = 0;
                var distanceFilter = 10;
                uexLocation.openLocation(locLevel, distanceFilter);
            }
            openLocation();
            uexLocation.onChange = function (lat, log) {
                $.request({
                    urlType:'getHospitalInfo',
                    data: {
                        access_token: $.getStorage('access_token'),
                        epsbht01008: '01',//用户终端类型
                        epsbht01006: log,//经度
                        epsbht01007: lat,//维度
                        name: name//医院名称
                    }
                }, function (data) {
                    if(data.success) {
                        setHosList(data.data);
                    }
                    else{
                        //$.toast('网络错误');
                    }
                }, 'json')
            };
        }
        _request('');
        /*
        * 根据请求结果设置html
        * */
        function setHosList(data){
            var html='';
            var access_token= $.getStorage('access_token');
            var imgPath= $.serverSettings.serverPath+'/mobile/mcheap/hs/hsForAppAction!getHospitalImage.do?access_token='+access_token+'&path=';
            for(var i=0;i<data.length;i++) {
                html += '<div class="list-item">';
                html += '<div class="item-content mdui-box" data-clthtp01id="' + data[i].clthtp01id + '">';
                html += '<div class="item-img">';
                html += '<img src="' + imgPath + data[i].clthtp01010 + '">';
                html += '</div>';
                html += '<div class="mdui-box-flex-1">';
                html += '<div class="item-title">' + data[i].clthtp01001 + '</div>';
                html += '<div class="item-sub">地址：<span>' + data[i].clthtp01006 + '</span></div>';
                html += '<div class="item-time">门诊时间：' + data[i].clthtp01011 + '</div>';
                html += '</div>';
                html += '</div>';
                html += '<div class="item-dis" data-clthtp01004="' + data[i].clthtp01004 + '" data-clthtp01005="' + data[i].clthtp01005 + '">' + data[i].distance + 'km</div>';
                html += '</div>';
            }
            $('.list').html(html);
            $('img').on('error',function(){
                $(this).attr('src','../../../public/images/noImg.jpg');
            })
        }
        /*
        * 点击医院列表
        * */
        $('.list').on('tap','.item-content',function(){
            $.openWin({
                name:"hos_main",
                animId : 2,
                url:'wgtroot://hospital/hos_main/ui/hos_main.html',
                pageParam: {
                    address:$(this).find('.item-sub>span').html(),
                    dis:$(this).siblings('.item-dis').html(),
                    id:$(this).data('clthtp01id'),
                    time:$(this).find('.item-time').html(),
                    name:$(this).find('.item-title').html()
                }
            });
        });
        /*
        * 点击搜索按钮
        * */
        $('.search-img').on('tap',function(){
            _request($(this).val());
        });
        /*
        * 点击列表导航按钮
        * */
        $('.list').on('tap','.item-dis',function(){
            alert('导航到该位置？');
            var clthtp01005=$(this).data('clthtp01005');//目标纬度
            var clthtp01004=$(this).data('clthtp01004');//目标经度
        });
        $('.sp').on('tap',function(){
            $.openWin({
                name:"service_price",
                animId : 2,
                url:'wgtroot://hospital/hos_list/ui/service_price.html'
            });
        })
    });
</script>
</body>
</html>