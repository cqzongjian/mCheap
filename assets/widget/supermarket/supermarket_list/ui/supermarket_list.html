<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>mCollection</title>
    <meta name="viewport" content="target-densitydpi=device-dpi,width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="../../../static/mdui/css/mdui.min.css">
    <link rel="stylesheet" href="../../../static/mCheap/css/mCommon.css">
    <style>
        *{
            font-family: "Microsoft YaHei";
        }
        html{
            height: 100%;
            width: 100%;
            overflow: hidden;
        }
        body{
            background-color: #E6EAE8;
            overflow: hidden;
        }
        .header-box{
            background-color: #F39426;
            padding: 0;
        }
        .header{
            background-color: #F39426;
        }
        .saoma{
            padding-right: 1rem;
            padding-top: 0.75rem;
            padding-left: 0.625rem;
        }
        .saoma>img{
            width:auto;
            height: 1.25rem;
        }
        #search{
            border: none;
            height: 1.75rem;
        }
        .search-box{
            border: 1px solid #cccccc;
            border-radius: 5px;
            background-color: #FFFFFF;
            height: 1.75rem;
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
            overflow: hidden;
        }
        .search-img{
            height:1.75rem;
            line-height: 1.75rem;
            margin-right: 0.5rem;
            margin-top: 0.25rem;
            margin-bottom: 0.25rem;
            padding-left: 2rem;
        }
        .search-img>img{
            width: 1.25rem;
            height: 1.25rem;
        }
        .message>img{
            width:auto;
            height: 1.25rem
        }
        .title{
            text-align: center;
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0px;
            line-height: 2.75rem;
            color: #FFFFFF;
        }
        /*=============市场头===================*/
        .tj-list-item:last-child{
            border: none;
        }
        .tj-list-item>div:nth-child(2){
            padding-left: 0.5rem;
        }
        .tj-list-item>div>img{
            width: 5rem;
            height: 4rem;
            border-radius: 5px;
        }
        .price-reorder-choose{
            width: 10rem;
            background-image: url("../image/greenright.png");
            background-position: 85%;
            background-repeat: no-repeat;
            background-size: 1.2rem 0.8rem;
            padding: 0.5rem;
            color: green;
            background-color: #e5f3e5;
            text-align: center;
        }
        .price-reorder{
            width: 10rem;
            background-size: 1.2rem 0.8rem;
            padding: 0.5rem;
            color: black;
            background-color: #e5f3e5;
            text-align: center;
        }
        .reorder-box{
            background-color: white;
            padding-top: 2.75rem;
        }
        .market{
            margin-top: 2.75rem;
            height: 100%;
            width: 100%;
            padding: 1rem;
            background-color: white;
        }
        .market-img{
            width: 7rem;
            height: 5rem;
            border-radius: 0.3rem;
        }
        .market-title{
            display: inline-block;
            margin-left: 1rem;
        }
        .market-describe{
            width: auto;
        }
        .market-comment{
            line-height: 100%;;
            border:1px solid #F57F20;
            font-size: 0.8rem;
            padding: 0.2rem 0.5rem 0.2rem 0.5rem;
            border-radius: 1rem;
            display: inline-block;
            float: right;
            color: #F57F20;
        }
        .start-box>img{
            height: 1rem;
            width: 1rem;
        }
        .open-time{
            display: inline-block;
            margin-left: 1.2rem;
        }
        /*=========================================*/

        /*=============产品展示===================*/
        .product-show{
            padding:0 1rem;
            margin-top: 2.75rem;
            background-color: white;
            margin-bottom: 1rem;
            height: 100%;
            overflow: hidden;
        }
        /*========================list===========================*/
        .img-box{
            width: 7rem;
            height: 5rem;
        }
        .list-box{
            position: relative;
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #cccccc;
        }
        .set-like>img{
            position: absolute;
            width: 1.2rem;
            height: 1.2rem;
            bottom:10%;
            right: 5%;
        }
        .far{
            font-size: 0.8rem;
            position: absolute;
            top:10%;
            right: 5%;
        }
        .market-img-box{
            width: 100%;
            height: 100%;
        }
        .market-list-name{

        }
        .address{
            white-space:nowrap;
            width: 10rem;
            overflow: auto;
            font-size: 0.8rem;
            padding-left: 1rem;
            background: url("../image/dis.png")no-repeat left center;
            background-size: 0.8rem auto;
        }
        .market-detail{
            padding-left: 1rem;
        }
        .standard{
            padding: 0.5rem 0.5rem 0.5rem 1rem;
        }
        .time{
            font-size: 0.8rem;
            padding-left: 1rem;
            background: url("../image/time.png")no-repeat left center;
            background-size: 0.8rem auto;
        }
        .price{
            margin-left: 3rem;
        }
        /*=========================list==========================*/

        /*======筛选======*/
        .mc{
            position: fixed;
            background: rgba(0,0,0,0.3);
            width:100%;
            height:100%;
            z-index:2;
            display: none;
        }
        .sx-box{
            width: 100%;
            margin-top: 2.75rem;
            background-color: white;
            border-bottom: 1px solid #CCCCCC;
        }
        .sx-left{
            background: url("../image/down.png")no-repeat 70%;
            background-size: 0.7rem 0.5rem;
            border-right: 1px solid #CCCCCC;
            width: 50%;
            text-align: center;
            padding: 0.5rem;
        }
        .sx-left-on{
            background: url("../image/lvup.png")no-repeat 70%;
            background-size: 0.7rem 0.5rem;
            border-right: 1px solid #CCCCCC;
            width: 50%;
            color: green;
            text-align: center;
            padding: 0.5rem;
        }
        .sx-right{
            background: url("../image/down.png")no-repeat 70%;
            background-size: 0.7rem 0.5rem;
            width: 50%;
            text-align: center;
            padding: 0.5rem;
        }
        .my-item{
            padding: 0.5rem 0.5rem 0.5rem 1rem;
            background-color: white;
            border-bottom: 1px solid #CCCCCC;
        }
        .my-item-choose{
            position: relative;
            height: 3rem;
            background-color: white;
        }
        .my-item-on{
            background: url("../image/greenright.png")no-repeat 90%;
            background-size: 1.2rem 0.8rem;
            color: green;
            padding: 0.5rem 0.5rem 0.5rem 1rem;
            background-color: white;
            border-bottom: 1px solid #CCCCCC;
        }
        .sx-right-on{
            background: url("../image/lvup.png")no-repeat 70%;
            background-size: 0.7rem 0.5rem;
            width: 50%;
            color: green;
            text-align: center;
            padding: 0.5rem;
        }
        .distance{/*my*/
            display: none;
        }
        .distance-item{
            border-bottom: 1px solid #CCCCCC;
            padding: 0.5rem 0.5rem 0.5rem 1rem;
            background-color: white;
        }
        .distance-item-on{
            background: url("../image/greenright.png")no-repeat 90%;
            background-size: 1.2rem 0.8rem;
            padding: 0.5rem 0.5rem 0.5rem 1rem;
            background-color: white;
            color: green;
            border-bottom: 1px solid #CCCCCC;
        }
        .reset{
            position: absolute;
            left: 5%;
            top:15%;
            padding: 0.25rem;
            border: 1px solid #CCCCCC;
        }
        .sure{
            position: absolute;
            right: 5%;
            top:15%;
            padding: 0.25rem;
            border: 1px solid #CCCCCC;
        }

        /*======筛选======*/
        .top-choose{
            background: url("../image/shaixuan.png")no-repeat center;
            background-size: 1.5rem 1.5rem;
            margin-right: 0.5rem;
            margin-left: 0.5rem;
            width: 1.5rem;
            height: auto;
        }
        .no-data{
            height: 3rem;
            text-align: center;
            line-height: 3rem;
            border-bottom: 1px solid #CCCCCC;
        }
    </style>
</head>
<body>
<div class="header-box mdui-bar mdui-bar-nav mdui-box">
    <div class="header">
        <div class="back mdui-action-back" style="text-align: center;margin-top: 0.8rem;margin-right: 0.8rem;margin-left: 0.8rem;"><img src="../image/back.png" style="width: 0.8rem;height: 1.3rem;"></div>
    </div>
    <div class="mdui-box-flex-1 mdui-box search-box">
        <div class="mdui-box-flex-1">
            <form action="">
                <input type="text" id="search" placeholder="超市"/>
            </form>
        </div>
        <div class="search-img"><img src="../image/search-orange.png"></div>
    </div>
    <div class="top-choose"></div>
</div>
<!--筛选蒙层-->
<div class="mc">
    <div class="mdui-box sx-box">
        <div class="sx-l sx-left">距离</div>
        <div class="sx-r sx-right">筛选</div>
    </div>
    <div class="distance">
        <div class="distance-item">附近</div>
        <div class="distance-item">1km</div>
        <div class="distance-item">2km</div>
        <div class="distance-item">3km</div>
        <div class="distance-item">4km</div>
        <div class="distance-item">全城</div>
    </div>
    <div class="my">
        <div class="my-choose">
            <div class="my-item">常用地址</div>
            <div class="my-item">我关注的超市</div>
        </div>
        <div class="my-item-choose mdui-box">
            <div class="reset">重置</div>
            <div class="sure">确定</div>
        </div>
    </div>
</div>
<!--筛选蒙层-->

<div class="product-show" style="height:100%;width: 100%;overflow: auto;padding-bottom: 3rem;" id="list">

    <!--<div class="mdui-box list-box">-->
    <!--<div class="far">1.7km</div>-->
    <!--<div class="img-box">-->
    <!--<img src="../image/market_hongxinglu.png" class="market-img-box"/>-->
    <!--</div>-->
    <!--<div class="market-detail">-->
    <!--<div class="market-list-name">超市名字</div>-->
    <!--<div>-->
    <!--<img src="../image/star.png" class="start-img"/>-->
    <!--<img src="../image/star.png" class="start-img"/>-->
    <!--<img src="../image/star.png" class="start-img"/>-->
    <!--<img src="../image/star.png" class="start-img"/>-->
    <!--<img src="../image/star.png" class="start-img"/>-->
    <!--</div>-->
    <!--<div class="address">地址d</div>-->
    <!--<div class="time">营业时间</div>-->
    <!--</div>-->
    <!--<div class="set-like">-->
    <!--<img src="../image/like.png"/>-->
    <!--</div>-->
    <!--</div>-->

</div>



<!--页面-->
<script src="../../../static/mdui/js/mdui.js"></script>
<script src="../../../static/mCheap/js/mCheap.config.js"></script>
<script src="../../../server.js"></script>
<script src="../js/choose.js"></script>
<script src="../../../static/mCheap/js/scroll.js"></script>
<script>
    var requestFlag=true;//请求开关
    var obj={distance:'',focus:'',ppiont:'',pageNum:1};
    $.uexWindowReady(function(){
        var option = {id:"list",funs:{after:function(){
            if(requestFlag){
                obj.pageNum=obj.pageNum+1;
                var distance=obj.distance;
                var focus=obj.focus;
                var ppiont=obj.ppiont;
                var store=$('#search').val();
                requestData(distance,focus,ppiont,store,obj.pageNum);
            }else{
                $.toast('没有更多了!');
            }
        }}};
        $.initScroll(option);
        requestData('','','','',obj.pageNum);
        var oForm =  document.getElementsByTagName("form")[0];
        oForm.onsubmit = function(){
            $('.search-img').trigger('tap');
            return false;
        };
    });

    //请求所有超市
    function requestData(distance,focus,ppiont,store,pageNum){
        $.request({
            urlType:'nearSupermarkets',
            data:{
                "access_token": $.getStorage('access_token'),
                log: $.getStorage('log'),
                lat:$.getStorage('lat'),
                distance :distance?distance:'',
                focus:focus?focus:'',
                ppiont:ppiont?ppiont:'',
                mc:store?store:'',
                page:pageNum,
                pageSize:'10'
            }
        },function(json){
            if(json.success) {
//                alert(JSON.stringify(json)+"附近药店");
                var data=json.data;
                if(data.length){
                    setData(data);
                }else{
                    if(pageNum==1){
                        setData(data);
                    }else{
                        $.toast('没有更多了!');
                        requestFlag=false;
                    }
                }
            }
            else {
                alert('网络错误');
            }
        });
    }

    //筛选点击确定后
    $('.sure').on('tap',function(){
        var far= $('.sx-l').html(),ppiont,focus;
        far = getDistance(far);
        obj.distance=far;
        if($('.my-choose>div:first-child').hasClass('my-item-on')){
            ppiont ='1';
            obj.ppiont=ppiont;
        }else{
            ppiont ='';
            obj.ppiont=ppiont;
        }
        if($('.my-choose>div:last-child').hasClass('my-item-on')){
            focus = '1';
            obj.focus=focus;
        }else{
            focus = '';
            obj.focus=focus;
        }
        obj.pageNum=1;
        $('#list').html('');
        requestData(far,focus,ppiont,'',obj.pageNum);
        $('.mc').hide();
        $('.top-choose').removeClass('top-choose-on');
    });

    //单个药店的点击事件
    $('.product-show').on('tap','.list-box',function(){

//        alert($(this).data('star')+"&&&&&&&&")
        $.openWin({
            name:"product_show",
            animId : 2,
            url:'wgtroot://supermarket/market_product_show/ui/product_show.html',
            pageParam: {
                picture:$(this).data('picture'),
                lsh:$(this).data('lsh'),
                star:$(this).data('star'),
                marketName:$(this).find('.market-list-name').html(),
                address:$(this).find('.address').html(),
                yytime:$(this).find('.time').html(),
                tiaoshu:$(this).data('tiaoshu'),
                focus:$(this).data('focus'),
                range:$(this).data('range'),
                distance:$(this).find('.far').html(),
                lat:$(this).data('lat'),
                log:$(this).data('log')
            }
        });
    });

    //搜索
    $(document).on('tap','.search-img',searchSrore);
    function searchSrore(){
        var mc= $('#search').val();
        if(mc){
            $('#list').html('');
            obj.pageNum=1;
            requestData('','','',mc,obj.pageNum);
        }else{
            alert('请输入您要查询的超市名');
        }
    }

    //返回大首页
    $('.saoma').on('tap',function(){
        $.execScript({
            winName:'medicine',
            script:'$.closeWin()'
        });
    });
</script>
</body>
</html>