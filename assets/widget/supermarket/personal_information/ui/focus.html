<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>mCollection</title>
    <meta name="viewport" content="target-densitydpi=device-dpi,width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="../../../static/mdui/css/mdui.min.css">
    <link rel="stylesheet" href="../../../static/mCheap/css/mCommon.css">
    <style>
        *{
            font-family: "Microsoft YaHei";
        }
        body{
            width: 100%;
            background-color: #E6EAE8;
            padding-top: 2.75rem;
        }
        .header-box{
            background-color: #F39426;
            padding: 0;
        }
        .header{
            width: 100%;
            height: 100%;
            position: relative;
        }
        .back{
            padding-right: 1rem;
            padding-left: 1rem;
            padding-top: 0.75rem;
            position: absolute;
            z-index: 100;
        }
        .back img{
            width:auto;
            height: 1.25rem;
        }
        .title{
            text-align: center;
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            line-height: 2.75rem;
            color: #FFFFFF;
        }
        .content{
            height: 100%;
            background-color: #ffffff;
        }
        .second-title{
            /*height: 8%;*/
            /*width: 100%;*/
            border-bottom: 1px solid #B0B0B0;
        }
        .second-title:after{
            display: table;
            clear: both;
            content: '';
        }
        .cj-imgs,.comment-xz{
            text-align: center;
            padding-top: 1rem;
            padding-bottom: 0.8rem;
        }
        .choose{
            color:#F39426;
            text-align: center;
            padding-top: 1rem;
            padding-bottom: 0.8rem;
            border-bottom: 0.2rem solid #F39426;
        }
        .comment-lists{
            height: 100%;
            overflow-y: auto;
            display: none;
        }
        /*==================图片框=======================*/

        /*==================图片框=======================*/
        /*==================品种详情=======================*/
        .pzxq-content{
            height: 100%;
            display: none;
            overflow-y: auto;
        }
        /*==================评论蒙层=======================*/

        .vertical{
            margin-top: 0.8rem;
            color: #666666;
        }

        /*========================list===========================*/
        .img-box{
            width: 7rem;
            height: 5rem;
        }
        .list-box{
            position: relative;
            padding-left: 1rem;
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #cccccc;
        }
        .set-like{
            width: 1.5rem;
            height: 1.5rem;
            background-repeat: no-repeat;
            background-image: url("../images/like.png");
            background-position: center;
            background-size: 1.2rem 1.2rem;
            position: absolute;
            bottom:10%;
            right: 5%;
        }
        .set-dislike{
            width: 1.5rem;
            height: 1.5rem;
            background-repeat: no-repeat;
            background-image: url("../images/dislike.png");
            background-position: center;
            background-size: 1.2rem 1.2rem;
            position: absolute;
            bottom:10%;
            right: 5%;
        }
        .far{
            font-size: 0.8rem;
            position: absolute;
            top:10%;
            right: 5%;
        }
        .market-img-box{
            width: 100%;
            height: 100%;
        }
        .market-list-name{

        }
        .start-img-box>img{
            width: 1rem;
            height: 1rem;
        }
        .address{
            white-space:nowrap;
            width: 10rem;
            overflow: auto;
            font-size: 0.8rem;
            padding-left: 1rem;
            background: url("../images/dis.png")no-repeat left center;
            background-size: 0.8rem auto;
        }
        .factory,.standard{
            width: 12rem;
            padding: 0.15rem 1rem 0.15rem 0;
            font-size: 0.8rem;
        }
        .market-detail{
            padding-left: 1rem;
        }
        .time{
            font-size: 0.8rem;
            padding-left: 1rem;
            background: url("../images/time.png")no-repeat left center;
            background-size: 0.8rem auto;
        }
        .store-price{
            font-weight: 600;
            color: #6BB250;
        }
        .classify-content{
            overflow-y: auto;
        }
        /*=========================list==========================*/



    </style>
</head>
<body>
<div class="header-box mdui-bar mdui-bar-nav">
    <div class="header">
        <div class="back mdui-action-back"></div>
        <div class="title">我的关注</div>
    </div>
</div>
<div class="content mdui-box-ver mdui-box">
    <!--==========================只有两个tab================================-->
    <div class="second-title mdui-box">
        <div class="comment-xz mdui-box-flex-1">关注超市</div>
        <div class="vertical">|</div>
        <div class="cj-imgs mdui-box-flex-1">关注商品</div>
    </div>
    <div class="classify-content mdui-box-flex-1">
        <div id="con-0" class="comment-lists">



            <!--<div class="mdui-box list-box">-->
            <!--<div class="far">1.7km</div>-->
            <!--<div class="img-box">-->
            <!--<img src="../images/market_hongxinglu.png" class="market-img-box"/>-->
            <!--</div>-->
            <!--<div class="market-detail">-->
            <!--<div class="market-list-name">超市名字</div>-->
            <!--<div class="start-img-box">-->
            <!--<img src="../images/star.png"/>-->
            <!--<img src="../images/star.png"/>-->
            <!--<img src="../images/star.png"/>-->
            <!--<img src="../images/star.png"/>-->
            <!--<img src="../images/star.png"/>-->
            <!--</div>-->
            <!--<div class="address">地址d</div>-->
            <!--<div class="time">营业时间</div>-->
            <!--</div>-->
            <!--<div class="set-like gz"></div>-->
            <!--</div>-->


        </div>
        <div id="con-2" class="pzxq-content">

            <!--<div class="mdui-box list-box yp">-->
            <!--<div class="img-box">-->
            <!--<img src="../images/market_hongxinglu.png" class="market-img-box"/>-->
            <!--</div>-->
            <!--<div class="market-detail">-->
            <!--<div class="market-list-name">超市名字</div>-->
            <!--<div class="factory">的空间上发了就爱上的离开房间了卡坚实的路口附近路口的撒娇了罚款及案例四大家看法</div>-->
            <!--<div class="standard">营业时间</div>-->
            <!--<div class="store-price">￥123123</div>-->
            <!--</div>-->
            <!--<div class="set-like">-->
            <!--<img src="../images/like.png"/>-->
            <!--</div>-->
            <!--</div>-->



        </div>
    </div>
</div>



<!--页面-->
<script src="../../../static/mdui/js/mdui.min.js"></script>
<script src="../../../static/mCheap/js/mCheap.config.js"></script>
<script src="../../../server.js"></script>
<script src="../../public.js"></script>
<script>
    $.uexWindowReady(function(){
        $('.comment-xz').trigger('tap');
        setProStoreData();
        setMedicineContentData();
    });

    //设置关注产品
    function setMedicineContentData(){
        $.request({
            urlType:'focusGoods',
            data:{
                "access_token": $.getStorage('access_token')
            }
        },function(json){
            if(json.success){
                var data = json.data;
                setFocusMed(data);
            }
            else {
                alert('网络错误')
            }
        });
    }

    //设置关注超市
    function setProStoreData(){
        $.request({
            urlType:'focusSupermarket',
            data:{
                "access_token": $.getStorage('access_token')
            }
        },function(json){
            if(json.success){
                var data = json.data;
                setFocusStore(data);
            }
            else {
                alert('网络错误')
            }
        });
    }


    function setFocusMed(data){
        var html='',len=data.length;
        if(len){
            for(var i=0;i<len;i++){
                html +='<div class="mdui-box list-box cp" data-id="'+data[i].espgds01id+'" data-espgds01002="'+data[i].espgds01002+'" data-espgds01004="'+data[i].espgds01004+'" data-picture="'+data[i].espgds01010+'">';
                html +='<div class="img-box">';
                html +='<img src="'+ $.serverSettings.serverPath+'/mobile/mcheap/shopAction!getGoodsPicture.do?access_token='+ $.getStorage('access_token')+'&url='+data[i].espgds01010+'" class="market-img-box"/>';
                html +='</div>';
                html +='<div class="market-detail">';
                html +='<div class="market-list-name">'+data[i].espgds01001+'</div>';
                if(data[i].espgds01004){
                    html +='<div class="factory">'+data[i].espgds01004+'</div>';
                }else{
                    html +='<div class="factory">产地:</div>';
                }
                if(data[i].espgds01002){
                    html +='<div class="standard">'+data[i].espgds01002+'</div>';
                }else{
                    html +='<div class="standard">规格:</div>';
                }
                if(data[i].price){
                    html +='<div class="store-price">￥'+data[i].price+'</div>';
                }
                html +='</div>';
                html +='<div class="set-like gz"></div>';
                html +='</div>';
            }
            $('.pzxq-content').html(html);
        }else{
            $.toast('亲！您还没有关注任何商品哦！');
        }
    }

    //往超市列表跳转
    $('.pzxq-content').on('tap','.img-box',function(){
        var price = $(this).parent().find('.store-price').html();
        if(price){
            var id =$(this).parent().data('id');
            var drugName = $(this).parent().find('.market-list-name').html();
            var espgds01002=$(this).parent().data('espgds01002');
            var espgds01004=$(this).parent().data('espgds01004');
            $.openWin({
                name:"product_list_market",
                animId : 2,
                url:'wgtroot://supermarket/product_list/ui/product_list_market.html',
                pageParam: {
                    id:id,
                    proName:drugName,
                    standard:espgds01002,
                    factory:espgds01004,
                    price:price,
                    picture:$(this).parent().data('picture')
                }
            });
        }else{
            alert('该药品今日未采价');
        }
    });

    function setFocusStore(data){
        var html='',len=data.length;
        if(len){
            for(var i=0;i<len;i++){
                var m=0,j=0;
                html +='<div class="mdui-box list-box cs" data-range="'+data[i].cltpit01011+'" data-lsh="'+data[i].cltpit01id+'" data-star="'+data[i].star+'" data-tiaoshu="'+data[i].tiaoshu+'" data-focus="'+data[i].isfocus+'" data-picture="'+data[i].picture+'" data-log="'+data[i].cltpit01007+'" data-lat="'+data[i].cltpit01008+'">';
                html +='<div class="far">'+data[i].distance+'km</div>';
                html +='<div class="img-box">';
                html +='<img src="'+ $.serverSettings.serverPath+'/mobile/mcheap/mcheapAction!getMarketPicture.do?access_token='+ $.getStorage('access_token')+'&url='+data[i].picture+'" class="market-img-box"/>';
                html +='</div>';
                html +='<div class="market-detail">';
                html +='<div class="market-list-name">'+data[i].cltpit01001+'</div>';
                html +='<div class="start-img-box">';
                if(data[i].star) {
                    for(j;j<parseInt(data[i].star);j++){
                        html+='<img src="../images/star_01.png" />';
                        m++;
                    }
                    if (parseInt(data[i].star.split('.')[1])>0){
                        html+='<img src="../images/star_03.png"/>';
                        m++;
                    }
                    if(m<5){
                        for (j=m;j<5;j++){
                            html+='<img src="../images/star_02.png"/>';
                        }
                    }
                } else{
                    for (j=0;j<5;j++){
                        html+='<img src="../images/star_02.png" />'
                    }
                }
                html +='</div>';
                html +='<div class="address">'+data[i].cltpit01004+'</div>';
                html +='<div class="time">营业时间:'+data[i].cltpit01005+'~'+data[i].cltpit01006+'</div>';
                html +='</div>';
                var flag=parseInt(data[i].isfocus);
                if(flag){
                    html +='<div class="set-like gz"></div>';
                }else{
                    html +='<div class="set-dislike gz"></div>';
                }
                html +='</div>';
            }
            $('.comment-lists').html(html);
        }else{
            $.toast('亲！您还没有关注任何超市哦！');
        }
    }

    //列表标题切换
    $('.second-title>div').on('tap',function(){
        if(1){
            var index=$(this).index();
            var ele=$('.classify-content>div');
            if(!$(this).hasClass('choose')){
                $('.second-title>div').removeClass('choose');
                $(this).addClass('choose');
                ele.hide();
                $('#con-'+index).show();
            }
        }else{
            alert('数据加载中，请稍等');
        }
    });


    //往超市跳转
    $('.comment-lists').on('tap','.img-box',function(){
        var range =$(this).parent().data('range');
        var storeName = $(this).parent().find('.market-list-name').html();
        var storeAddress = $(this).parent().find('.address').html();
        var storeYysj = $(this).parent().find('.time').html();
        var storeStar = $(this).parent().data('storeStar');
        var lsh=$(this).parent().data('lsh');
        var tiaoshu=$(this).parent().data('tiaoshu');
        $.openWin({
            name:"product_show",
            animId : 2,
            url:'wgtroot://supermarket/market_product_show/ui/product_show.html',
            pageParam: {
                range:range,
                lsh:lsh,//流水号
                star:storeStar,//
                marketName:storeName,//
                address:storeAddress,//
                yytime:storeYysj,//
                tiaoshu:tiaoshu,//
                focus:1,
                picture:$(this).parent().data('picture'),
                lat:$(this).parent().data('lat'),
                log:$(this).parent().data('log')
            }
        });
    });

    //设置超市关注
    $('.comment-lists').on('tap','.gz',function(){
        var self=$(this);
        if($(this).hasClass('set-like')){
            $.request({
                urlType:'delFocusShop',
                data:{
                    "access_token": $.getStorage('access_token'),
                    cltpit01id:$(this).parent().data('lsh') //药店流水号
                }
            },function(json){
                if(json.success){
                    $.toast(json.message);
                    self.removeClass('set-like').addClass('set-dislike');
                    self.parent().remove();
                    refreshPage();
                }
                else {
                    alert('网络错误')
                }
            });
        }else{
            $.request({
                urlType:'addFocusShop',
                data:{
                    "access_token": $.getStorage('access_token'),
                    cltpit01id:$(this).parent().data('lsh'), //超市流水号
                    cltpit01001:$(this).parent().find('.market-list-name').html()//超市名称
                }
            },function(json){
                if(json.success){
                    $.toast(json.message);
                    self.removeClass('set-dislike').addClass('set-like');
                    refreshPage();
                }
                else {
                    alert('网络错误')
                }
            });
        }
    });


    //设置关注产品
    $('.pzxq-content').on('tap','.gz',function(){
        var self=$(this);
        var goods ={
            espgds01id:$(this).parent().data('id'),
            espgds01001:$(this).parent().find('.market-list-name').html(),//商品名称,
            espgds01002:$(this).parent().data('espgds01002')?$(this).parent().data('espgds01002'):'',//商品规格
            espgds01004:$(this).parent().data('espgds01004')?$(this).parent().data('espgds01004'):''//商品产地
        };
        if($(this).hasClass('set-dislike')){
            $.request({
                urlType:'addFocuShopping',
                data:{
                    "access_token": $.getStorage('access_token'),
                    goods :JSON.stringify(goods)
                }
            },function(json){
                if(json.success) {
                    $.toast(json.message);
                    self.removeClass('set-dislike').addClass('set-like');
                }
                else {
                    alert('网络错误')
                }
            });
        }else{
            $.request({
                urlType:'delFocusShopping',
                data:{
                    "access_token": $.getStorage('access_token'),
                    espgds01id :$(this).parent().data('id')//药品流水号
                }
            },function(json){
                if(json.success) {
                    $.toast(json.message);
                    self.parent().remove();
                    self.removeClass('set-like').addClass('set-dislike');
                }
                else {
                    alert('网络错误')
                }
            });
        }
    });
</script>
</body>
</html>