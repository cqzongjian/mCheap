<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>mCollection</title>
    <meta name="viewport" content="target-densitydpi=device-dpi,width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="../../../static/mdui/css/mdui.min.css">
    <link rel="stylesheet" href="../../../static/mCheap/css/mCommon.css">
    <style>
        *{
            font-family: "Microsoft YaHei";
        }
        /*html{*/
            /*width: 100%;*/
            /*overflow: hidden;*/
        /*}*/
        body{
            /*overflow-y: hidden;*/
            width: 100%;
            /*height: 100%;*/
            background-color: white;
            padding-top: 2.75rem;

        }
        .header-box{
            background-color: #3BA15C;
            padding: 0;
        }
        .header{
            width: 100%;
            height: 100%;
            position: relative;
        }
        .back{
            padding-right: 1rem;
            padding-left: 1rem;
            padding-top: 0.75rem;
            position: absolute;
            z-index: 100;
        }
        .back img{
            width:auto;
            height: 1.25rem;
        }
        .title{
            text-align: center;
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            line-height: 2.75rem;
            color: #FFFFFF;
        }
        .content{
            height: 100%;
            background-color: #ffffff;
        }
        .second-title{
            border-bottom: 1px solid #B0B0B0;
        }
        .second-title:after{
            display: table;
            clear: both;
            content: '';
        }
        .cj-imgs,.comment-xz{
            text-align: center;
            padding-top: 1rem;
            padding-bottom: 0.8rem;
        }
        .choose{
            color:#3BA15C;
            text-align: center;
            padding-top: 1rem;
            padding-bottom: 0.8rem;
            border-bottom: 0.2rem solid #3BA15C;
        }
        .comment-lists{
            display: none;
        }
        /*==================图片框=======================*/

        /*==================图片框=======================*/
        /*==================品种详情=======================*/
        .pzxq-content{
            display: none;
        }
        /*==================评论蒙层=======================*/

        .vertical{
            margin-top: 0.8rem;
            color: #666666;
        }

        /*========================list===========================*/
        .img-box{
            width: 7rem;
            height: 5rem;
        }
        .list-box{
            position: relative;
            padding-left: 1rem;
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #cccccc;
        }
        .set-like{
            width: 1.5rem;
            height: 1.5rem;
            background-repeat: no-repeat;
            background-image: url("../images/like.png");
            background-position: center;
            background-size: 1.2rem 1.2rem;
            position: absolute;
            bottom:10%;
            right: 5%;
        }
        .set-dislike{
            width: 1.5rem;
            height: 1.5rem;
            background-repeat: no-repeat;
            background-image: url("../images/dislike.png");
            background-position: center;
            background-size: 1.2rem 1.2rem;
            position: absolute;
            bottom:10%;
            right: 5%;
        }
        .far{
            font-size: 0.8rem;
            position: absolute;
            top:10%;
            right: 5%;
        }
        .market-img-box{
            width: 100%;
            height: 100%;
        }
        .market-list-name{

        }
        .start-img-box>img{
            width: 1rem;
            height: 1rem;
        }
        .address{
            white-space:nowrap;
            width: 10rem;
            overflow: auto;
            font-size: 0.8rem;
            padding-left: 1rem;
            background: url("../images/dis.png")no-repeat left center;
            background-size: 0.8rem auto;
        }
        .factory,.standard{
            width: 12rem;
            padding: 0.15rem 1rem 0.15rem 0;
            font-size: 0.8rem;
        }
        .market-detail{
            padding-left: 1rem;
        }
        .time{
            font-size: 0.8rem;
            padding-left: 1rem;
            background: url("../images/time.png")no-repeat left center;
            background-size: 0.8rem auto;
        }
        .store-price{
            font-weight: 600;
            color: #6BB250;
        }
        .classify-content{
            overflow-y: auto;
        }
        /*=========================list==========================*/



    </style>
</head>
<body>
<div class="header-box mdui-bar mdui-bar-nav">
    <div class="header">
        <div class="back mdui-action-back"></div>
        <div class="title">我的关注</div>
    </div>
</div>
<div class="content mdui-box-ver mdui-box">
    <!--==========================只有两个tab================================-->
    <div class="second-title mdui-box">
        <div class="comment-xz mdui-box-flex-1">关注药店</div>
        <div class="vertical">|</div>
        <div class="cj-imgs mdui-box-flex-1">关注药品</div>
    </div>
    <div class="classify-content mdui-box-flex-1">
        <div id="con-0" class="comment-lists">


            <!--<div class="mdui-box list-box">-->
                <!--<div class="far">1.7km</div>-->
                <!--<div class="img-box">-->
                    <!--<img src="../images/market_hongxinglu.png" class="market-img-box"/>-->
                <!--</div>-->
                <!--<div class="market-detail">-->
                    <!--<div class="market-list-name">超市名字</div>-->
                    <!--<div class="start-img-box">-->
                        <!--<img src="../images/star.png"/>-->
                        <!--<img src="../images/star.png"/>-->
                        <!--<img src="../images/star.png"/>-->
                        <!--<img src="../images/star.png"/>-->
                        <!--<img src="../images/star.png"/>-->
                    <!--</div>-->
                    <!--<div class="address">地址d</div>-->
                    <!--<div class="time">营业时间</div>-->
                <!--</div>-->
                <!--<div class="set-like"></div>-->
            <!--</div>-->

        </div>
        <div id="con-2" class="pzxq-content">

            <!--<div class="mdui-box list-box yp">-->
            <!--<div class="img-box">-->
            <!--<img src="../images/market_hongxinglu.png" class="market-img-box"/>-->
            <!--</div>-->
            <!--<div class="market-detail">-->
            <!--<div class="market-list-name">超市名字</div>-->
            <!--<div class="factory">的空间上发了就爱上的离开房间了卡坚实的路口附近路口的撒娇了罚款及案例四大家看法</div>-->
            <!--<div class="standard">营业时间</div>-->
            <!--<div class="store-price">￥123123</div>-->
            <!--</div>-->
            <!--<div class="set-like"></div>-->
            <!--</div>-->

        </div>
    </div>
</div>



<!--页面-->
<script src="../../../static/mdui/js/mdui.min.js"></script>
<script src="../../../static/mCheap/js/mCheap.config.js"></script>
<script src="../../../server.js"></script>
<script src="../../public.js"></script>
<script>
    $.uexWindowReady(function(){
        $('.comment-xz').trigger('tap');
        setMedicineStoreData();
        setMedicineContentData();
    });

    //设置关注药品
    function setMedicineContentData(){
        $.request({
            urlType:'focusMedicine',
            data:{
                "access_token": $.getStorage('access_token')
            }
        },function(json){
            if(json.success){
                var data = json.data;
                setFocusMed(data);
            }
            else {
                alert('网络错误')
            }
        });
    }

    //设置关注药店
    function setMedicineStoreData(){
        $.request({
            urlType:'focusDrugstore',
            data:{
                "access_token": $.getStorage('access_token')
            }
        },function(json){
            if(json.success){
                var data = json.data;
                setFocusStore(data);
            }
            else {
                alert('网络错误')
            }
        });
    }


    function setFocusMed(data){
        var html='',len=data.length;
        if(len){
            for(var i=0;i<len;i++){
                html +='<div class="mdui-box list-box yp" data-id="'+data[i].id+'" data-midName="'+data[i].midName+'" data-tinyName="'+data[i].tinyName+'" data-focus="'+data[i].isfocus+'" data-picture="'+data[i].picture+'">';
                html +='<div class="img-box">';
                html +='<img src="'+ $.serverSettings.serverPath+'/mobile/mcheap/medicineAction!getMedicinePicture.do?access_token='+ $.getStorage('access_token')+'&url='+data[i].picture+'" class="market-img-box"/>';
                html +='</div>';
                html +='<div class="market-detail">';
                html +='<div class="market-list-name">'+data[i].namemark+'</div>';
                html +='<div class="factory">'+data[i].factory+'</div>';
                html +='<div class="standard">'+data[i].specification+'</div>';
                if(data[i].price){
                    html +='<div class="store-price">￥'+data[i].price+'</div>';
                }
                html +='</div>';
                html +='<div class="set-like gz">';
                html +='</div>';
                html +='</div>';
            }
            $('.pzxq-content').html(html);
        }else{
            $.toast('亲！您还没有关注任何药品哦！');
        }
    }

    //往药品跳转
    $('.pzxq-content').on('tap','.img-box',function(){
        var price = $(this).parent().find('.store-price').html();
        if(price){
            var id =$(this).parent().data('id');
            var drugName = $(this).parent().find('.market-list-name').html();
            var standard = $(this).parent().find('.standard').html();
            var factory = $(this).parent().find('.factory').html();
            var midName=$(this).parent().data('midName');
            var tinyName=$(this).parent().data('tinyName');
            var picture=$(this).parent().data('picture');
            $.openWin({
                flag:4,
                name:"shop_list",
                animId : 2,
                url:'wgtroot://medicine/shop_list/ui/shop_list.html',
                pageParam: {
                    id:id,
                    drugName:drugName,
                    standard:standard,
                    factory:factory,
                    midName:midName,
                    tinyName:tinyName,
                    price:price,
                    focus:'1',
                    picture:picture
                }
            });
        }else{
            alert('该药品今日未采价');
        }
    });
    //往药店跳转
    $('.comment-lists').on('tap','.img-box',function(){
        var range =$(this).parent().data('range');
        var storeName = $(this).parent().find('.market-list-name').html();
        var storeAddress = $(this).parent().find('.address').html();
        var storeYysj = $(this).parent().find('.time').html();
        var storeStar = $(this).parent().data('star');
        var lsh=$(this).parent().data('lsh');
        var picture=$(this).parent().data('picture');
        var tiaoshu=$(this).parent().data('tiaoshu');
        var log=$(this).parent().data('log');
        var lat=$(this).parent().data('lat');
        $.openWin({
            flag:4,
            name:"shop_sort",
            animId : 2,
            url:'wgtroot://medicine/medicine_shop/ui/shop_sort.html',
            pageParam: {
                range:range,
                lsh:lsh,
                storeStar:storeStar,
                storeName:storeName,
                storeAddress:storeAddress,
                storeYysj:storeYysj,
                tiaoshu:tiaoshu,
                focus:'1',
                picture:picture,
                log:log,
                lat:lat
            }
        });
    });


    function setFocusStore(data){
        var html='',len=data.length;
        if(len){
            for(var i=0;i<len;i++){
                var m=0,j=0;
                html +='<div class="mdui-box list-box yd" data-range="'+data[i].cltpit01011+'" data-lsh="'+data[i].cltpit01id+'" data-star="'+data[i].star+'" data-tiaoshu="'+data[i].tiaoshu+'" data-focus="'+data[i].isfocus+'" data-picture="'+data[i].picture+'" data-log="'+data[i].cltpit01007+'" data-lat="'+data[i].cltpit01008+'">';
                html +='<div class="far">'+data[i].distance+'km</div>';
                html +='<div class="img-box">';
                html +='<img src="'+ $.serverSettings.serverPath+'/mobile/mcheap/mcheapAction!getMarketPicture.do?access_token='+ $.getStorage('access_token')+'&url='+data[i].picture+'" class="market-img-box"/>';
                html +='</div>';
                html +='<div class="market-detail">';
                html +='<div class="market-list-name">'+data[i].cltpit01001+'</div>';
                html +='<div class="start-img-box">';
                if(data[i].star) {
                    for(j;j<parseInt(data[i].star);j++){
                        html+='<img src="../images/star_01.png" />';
                        m++;
                    }
                    if (parseInt(data[i].star.split('.')[1])>0){
                        html+='<img src="../images/star_03.png"/>';
                        m++;
                    }
                    if(m<5){
                        for (j=m;j<5;j++){
                            html+='<img src="../images/star_02.png"/>';
                        }
                    }
                } else{
                    for (j=0;j<5;j++){
                        html+='<img src="../images/star_02.png" />'
                    }
                }
                html +='</div>';
                html +='<div class="address">'+data[i].cltpit01004+'</div>';
                html +='<div class="time">营业时间:'+data[i].cltpit01005+'~'+data[i].cltpit01006+'</div>';
                html +='</div>';
                var flag=parseInt(data[i].isfocus);
                if(flag){
                    html +='<div class="set-like gz">';
                    html +='</div>';
                }else{
                    html +='<div class="set-like">';
                    html +='</div>';
                }
                html +='</div>';
            }
            $('.comment-lists').html(html);
        }else{
            $.toast('亲！您还没有关注任何药店哦！');
        }
    }

    //列表标题切换
    $('.second-title>div').on('tap',function(){
        if(1){
            var index=$(this).index();
            var ele=$('.classify-content>div');
            if(!$(this).hasClass('choose')){
                $('.second-title>div').removeClass('choose');
                $(this).addClass('choose');
                ele.hide();
                $('#con-'+index).show();
            }
        }else{
            alert('数据加载中，请稍等');
        }
    });



    //设置药店关注
    $('.comment-lists').on('tap','.set-like',function(){
        var self=$(this);
        if($(this).hasClass('set-like')){
            $.request({
                urlType:'delFocusDrugstore',
                data:{
                    "access_token": $.getStorage('access_token'),
                    cltpit01id:$(this).parent().data('lsh')//药店流水号
                }
            },function(json){
                if(json.success){
                    $.toast(json.message);
                    self.removeClass('set-like').addClass('set-dislike');
                    self.parent().remove();
                    refreshPage();
                }
                else {
                    alert('网络错误')
                }
            });
        }else{
            $.request({
                urlType:'addFocusDrugstore',
                data:{
                    "access_token": $.getStorage('access_token'),
                    cltpit01id:$(this).parent().data('lsh'),//超市流水号
                    cltpit01001:$(this).parent().find('.market-list-name').html()//超市名称
                }
            },function(json){
                if(json.success){
                    $.toast(json.message);
                    self.removeClass('set-dislike').addClass('set-like');
                    refreshPage();
                }
                else {
                    alert('网络错误')
                }
            });
        }
    });


    //设置关注产品
    $('.pzxq-content').on('tap','.gz',function(){
        var self=$(this);
        var medicine={
            id:$(this).parent().data('id'),//药品流水号,
            namemark:$(this).parent().find('.market-list-name').html(),//药品名称,
            specification:$(this).parent().find('.standard').html(),//药品规格,
            factory:$(this).parent().find('.factory').html()//药品生产商
        };
        if($(this).hasClass('set-dislike')){
            $.request({
                urlType:'addFocusMedicine',
                data:{
                    "access_token": $.getStorage('access_token'),
                     medicine :JSON.stringify(medicine)
                }
            },function(json){
                if(json.success) {
                    $.toast(json.message);
                    self.removeClass('set-dislike').addClass('set-like');
                }
                else {
                    alert('网络错误')
                }
            });
        }else{
            $.request({
                urlType:'delFocusMedicine',
                data:{
                    "access_token": $.getStorage('access_token'),
                     id :$(this).parent().data('id')//药品流水号
                }
            },function(json){
                if(json.success) {
                    $.toast(json.message);
                    self.parent().remove();
                    self.removeClass('set-like').addClass('set-dislike');
                }
                else {
                    alert('网络错误')
                }
            });
        }
    });
</script>
</body>
</html>