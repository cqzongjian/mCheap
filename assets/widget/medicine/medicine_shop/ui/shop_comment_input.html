<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>mCollection</title>
    <meta name="viewport" content="target-densitydpi=device-dpi,width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="../../../static/mdui/css/mdui.min.css">
    <link rel="stylesheet" href="../../../static/mCheap/css/mCommon.css">
    <link rel="stylesheet" href="../css/caipu.css">
    <style>
        *{
            font-family: "Microsoft YaHei";
        }
        body{
            background-color: #E6EAE8;
            padding-top: 2.75rem;

        }
        .header-box{
            background-color: #F9F9F9;
            padding: 0;
        }
        .header{
            width: 100%;
            height: 100%;
            position: relative;
        }
        .back{
            padding-right: 1rem;
            padding-left: 1rem;
            padding-top: 0.75rem;
            position: absolute;
            z-index: 100;
        }
        .back img{
            width:auto;
            height: 1.25rem;
        }
        .title{
            text-align: center;
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0px;
            line-height: 2.75rem;
            color: #363A3D;
        }
        /*=============市场头===================*/
        .market{
            padding: 1rem;
            background-color: white;
        }
        .market-img{
            width: 7rem;
            height: 5rem;
            border-radius: 0.3rem;
        }
        #input{
            padding-left: 1rem;
            padding-right: 1rem;
            border: none;
            color: #666666;
        }
        .line{
            width: 100%;
        }
        .grade{
            padding: 0.5rem;
            background-color: white;
            margin-top: 1rem;
        }
        .grade-box{
            padding: 0.5rem;
        }
        .start-img{
            float: right;
            padding: 0.5rem;
        }
        .start{
            width: 1rem;
            height: 1rem;
        }
        .start-box{
            /*float: right;*/
        }
        /*==============底部==================*/
        .sure{
            position: absolute;
            bottom: 0;
            background-color: white;
            height: 4rem;
            line-height: 4rem;
            width: 100%;
        }
        .anonymous{
            background: url("../image/anonymous.png") no-repeat 10%;
            background-size: 2rem 2rem;
            width: 70%;
            padding-left: 17%;
        }
        .publish{
            background-color: #3BA15C;
            width: 30%;
            color: white;
            text-align: center;
        }
        .publish-now{
            position: absolute;
            bottom: 0;
            padding: 1rem;
            text-align: center;
            background-color: #3BA15C;
            width: 100%;
            color: white;
        }

    </style>
</head>
<body>
<div>
    <div class="header-box mdui-bar mdui-bar-nav">
        <div class="header">
            <div class="back mdui-action-back"><img src="../image/backleft.png"></div>
            <div class="title">发表评论</div>
        </div>
    </div>
    <div class="market mdui-box">
        <div class="market-img-div">
            <!--<img src="../image/market_hongxinglu.png" class="market-img"/>-->
        </div>
        <div class="mdui-box-flex-1">
            <textarea name="" id="input" cols="30" rows="5" placeholder="亲，请在这里写评论哦！~"></textarea>
        </div>
    </div>
    <div class="grade">
        <div class="mdui-box line">
            <div class="grade-box">综合评分</div>
            <div id="comprehensive" class="mdui-box-flex-1 start-box">
                <div class="start-img">
                    <img class="start" src="../image/star.png">
                </div>
                <div class="start-img">
                    <img class="start" src="../image/star.png">
                </div>
                <div class="start-img">
                    <img class="start" src="../image/star.png">
                </div>
                <div class="start-img">
                    <img class="start" src="../image/star.png">
                </div>
                <div class="start-img">
                    <img class="start" src="../image/star.png">
                </div>
            </div>
        </div>
        <div class="mdui-box line">
            <div class="grade-box">相因</div>
            <div id="cheap" class="mdui-box-flex-1 start-box">
                <div class="start-img">
                    <img class="start" src="../image/star.png">
                </div>
                <div class="start-img">
                    <img class="start" src="../image/star.png">
                </div>
                <div class="start-img">
                    <img class="start" src="../image/star.png">
                </div>
                <div class="start-img">
                    <img class="start" src="../image/star.png">
                </div>
                <div class="start-img">
                    <img class="start" src="../image/star.png">
                </div>
            </div>
        </div>
        <div class="mdui-box line">
            <div class="grade-box">药品齐全度</div>
            <div id="clean" class="mdui-box-flex-1 start-box">
                <div class="start-img">
                    <img class="start" src="../image/star.png">
                </div>
                <div class="start-img">
                    <img class="start" src="../image/star.png">
                </div>
                <div class="start-img">
                    <img class="start" src="../image/star.png">
                </div>
                <div class="start-img">
                    <img class="start" src="../image/star.png">
                </div>
                <div class="start-img">
                    <img class="start" src="../image/star.png">
                </div>
            </div>
        </div>
        <div class="mdui-box line">
            <div class="grade-box">服务态度</div>
            <div id="fresh" class="mdui-box-flex-1 start-box">
                <div class="start-img">
                    <img class="start" src="../image/star.png">
                </div>
                <div class="start-img">
                    <img class="start" src="../image/star.png">
                </div>
                <div class="start-img">
                    <img class="start" src="../image/star.png">
                </div>
                <div class="start-img">
                    <img class="start" src="../image/star.png">
                </div>
                <div class="start-img">
                    <img class="start" src="../image/star.png">
                </div>
            </div>
        </div>
    </div>
    <!--<div class="sure mdui-box">-->
        <!--<div class="anonymous">匿名评价</div>-->
        <!--<div class="publish">发表评论</div>-->
    <!--</div>-->
    <div class="publish-now">发表评论</div>
</div>



<!--页面-->
<script src="../../../static/mdui/js/mdui.min.js"></script>
<script src="../../../static/mCheap/js/mCheap.config.js"></script>
<script src="../../../server.js"></script>
<script>
    var cltpit01id;//保存市场流水号
    var marketName;//保存市场名称
    var cheapStart=1;//记录相音星
    var cleanStart=1;//记录干净星
    var freshStart=1;//记录新鲜星
    var comprehensiveStart=0;//记录综合星
    $.uexWindowReady(function(){
        var pageData=$.pageParam;
        cltpit01id=$.strToJson(pageData).cltpit01id;
        marketName=$.strToJson(pageData).cltpit01001;
        var url=$.strToJson(pageData).url;
        setMarketPic(url);
    });
    //设置市场图片
    function setMarketPic(url){
        var marketPic='<img src="' + $.serverSettings.serverPath + '/mobile/mcheap/mcheapAction!getMarketPicture.do?access_token=' + $.getStorage('access_token') + '&url=' + url + '" class="market-img"/>';
        $('.market-img-div').html(marketPic);
        $('img').on('error',function(){
            $(this).attr('src','../../../public/images/noImg.jpg');
        });
    }

    //综合打分
    function setComprehensiveStart(index){
        var t;
        if(index<6){
            t=4;
        }
        if(index>=6&&index<9){
            t=3;
        }
        if(index>=9&&index<12){
            t=2;
        }
        if(index>=12&&index<15){
            t=1;
        }
        if(index==15){
            t=0;
        }
        $('#comprehensive>div').each(function(e){
            if(e>=t){
                $(this).find('.start').attr('src','../image/star-s.png');
            }else{
                $(this).find('.start').attr('src','../image/star.png');
            }
        });
    }

    //相音打分
    $('#cheap>div').on('tap',function(){
        var index=$(this).index();
        var c_index=changeNum(index);
        cheapStart=c_index+1;
        comprehensiveStart=cheapStart+cleanStart+freshStart;
        setComprehensiveStart(comprehensiveStart);
        $('#cheap>div').each(function(e){
            if(e>=index){
                $(this).find('.start').attr('src','../image/star-s.png');
            }else{
                $(this).find('.start').attr('src','../image/star.png');
            }
        });
    });

    //分数转换函数
    function changeNum(num){
        switch(num){
            case 4: return 0;
                break;
            case 3: return 1;
                break;
            case 2: return 2;
                break;
            case 1: return 3;
                break;
            case 0: return 4;
                break;
        }
    }

    //干净打分
    $('#clean>div').on('tap',function(){
        var index=$(this).index();
        var c_index=changeNum(index);
        cleanStart=c_index+1;
        comprehensiveStart=cheapStart+cleanStart+freshStart;
        setComprehensiveStart(comprehensiveStart);
        $('#clean>div').each(function(e){
            if(e>=index){
                $(this).find('.start').attr('src','../image/star-s.png');
            }else{
                $(this).find('.start').attr('src','../image/star.png');
            }
        });
    });

    //新鲜打分
    $('#fresh>div').on('tap',function(){
        var index=$(this).index();
        var c_index=changeNum(index);
        freshStart=c_index+1;
        comprehensiveStart=cheapStart+cleanStart+freshStart;
        setComprehensiveStart(comprehensiveStart);
        $('#fresh>div').each(function(e){
            if(e>=index){
                $(this).find('.start').attr('src','../image/star-s.png');
            }else{
                $(this).find('.start').attr('src','../image/star.png');
            }
        });
    });

    //发表评论
    $(document).on('tap','.publish-now',function(){
        var start="[{name:'01',value:'"+cheapStart+"'},{name:'02',value:'"+cleanStart+"'},{name:'03',value:'"+freshStart+"'}]";
        var commentDdtail=$('#input').val();
        if(commentDdtail){
            $('#input').val('');
            $.request({
                urlType: 'addYdAssess',
                data: {
                    "access_token": $.getStorage('access_token'),
                    epssgt07001: '01',
                    cltpit01id:cltpit01id,//药店流水号
                    cltpit01001:marketName,//药店名称
                    epssgt07002 :commentDdtail,//评价内容
                    stars:start
                }
            }, function (data) {
                if(data.success){
                    $.toast('谢谢您的评论');
                    $.execScript({
                        winName:'shop_comment',
                        script:'getComment();'
                    });
                    $.execScript({
                        winName:'shop_drug_list',
                        script:'changeCommentNum();'
                    });
                }else{
                    alert('网络错误');
                }
            });
        }else{
            $.toast('请输入您的意见，亲！');
        }
    });





</script>
</body>
</html>